<?xml version="1.0" encoding="utf-8"?>
<XSN Name="Alpha.xsn">
  <Table Name="ClientType" UID="{2ACD1D2D-43DE-49BC-8307-EC1736EDB506}" Alias="ctps" LocalName="Тип клиента" LocalListName="Типы клиентов" TitleName="Name">
    <Fields>
      <Field UID="{667F99D2-E617-402C-B01A-58224AF64A70}" Name="Name" Type="String" LabelName="Наименование" LocalListName="Наименование" NotNull="true"/>
    </Fields>
    <Indexes>
      <Index Field="Name" Unique="true"/>
    </Indexes>
  </Table>

  <Table Name="DeviceType" UID="{717FCA1B-3F75-405E-A254-7F1C452DB91C}" Alias="dctp" LocalName="Тип устройства" LocalListName="Типы устройств" TitleName="Name">
    <Fields>
      <Field UID="{400AC665-70B7-40C6-8CBC-650F045DF59A}" Name="Name" Type="String" LabelName="Наименование" LocalListName="Наименование" NotNull="true"/>
    </Fields>
    <Indexes>
      <Index Field="Name" Unique="true"/>
    </Indexes>
  </Table>

  <Table Name="Brands" UID="{FC3CCD13-8F5F-4B4D-AE05-E4755A098FE0}" Alias="brnd" LocalName="Брэнд" LocalListName="Брэнды" TitleName="Name">
    <Fields>
      <Field UID="{2A09565C-840D-4D78-8E20-5F351449E512}" Name="Name" Type="String" LabelName="Наименование" LocalListName="Наименование" NotNull="true"/>
    </Fields>
    <Indexes>
      <Index Field="Name" Unique="true"/>
    </Indexes>
  </Table>

  <Table Name="Models" UID="{77FF2D22-AE80-4FEA-B3DD-D630718C1795}" Alias="mdls" LocalName="Модель" LocalListName="Модели" TitleName="Name">
    <Fields>
      <Field UID="{92793C0D-C10A-4D26-B28A-F3E870F81902}" Name="Brand" Type="Int" LabelName="Брэнд" LocalListName="Брэнд" NotNull="true"/>
      <Field UID="{B6C389FB-477E-4BD5-BECC-D4A4B5154739}" Name="Name" Type="String" LabelName="Наименование" LocalListName="Наименование" NotNull="true"/>
    </Fields>
    <Indexes>
      <Index Field="Name" Unique="true"/>
    </Indexes>
    <Foreigns>
      <Foreign Field="Brand" ForeignClass="Brands" ForeignField="ID" ForeignViewNameField="Name"/>
    </Foreigns>
  </Table>

  <Table Name="StageRepairs" UID="{F63CC801-74BF-41EA-81A7-82D995EE9782}" Alias="sgrp" LocalName="Этап ремонта" LocalListName="Этапы ремонта" TitleName="Name">
    <Fields>
      <Field UID="{8EDBC378-FFF9-4FAC-9709-E1D65935D8A1}" Name="Name" Type="String" LabelName="Наименование" LocalListName="Наименование" NotNull="true"/>
    </Fields>
    <Indexes>
      <Index Field="Name" Unique="true"/>
    </Indexes>
  </Table>

  <Table Name="Colors" UID="{877EE283-72AE-4F20-8088-37CC378FE7C9}" Alias="clrs" LocalName="Цвет" LocalListName="Цвета" TitleName="Name">
    <Fields>
      <Field UID="{D9F51F56-9040-4E83-BF38-886C474F4C8D}" Name="Name" Type="String" LabelName="Наименование" LocalListName="Наименование" NotNull="true"/>
    </Fields>
    <Indexes>
      <Index Field="Name" Unique="true"/>
    </Indexes>
  </Table>

  <Table Name="ServiceType" UID="{D1C663AE-5594-4B76-B2EC-15DA84C1A815}" Alias="svtp" LocalName="Тип услуги" LocalListName="Типы услуг" TitleName="Name">
    <Fields>
      <Field UID="{7827AD63-1703-4F3E-82AA-6E6C394897C8}" Name="Name" Type="String" LabelName="Наименование" LocalListName="Наименование" NotNull="true"/>
    </Fields>
    <Indexes>
      <Index Field="Name" Unique="true"/>
    </Indexes>
  </Table>

  <Table Name="Clients" UID="{9D696E1C-37A4-4C58-AAC1-3AAD93057FDE}" Alias="clts" LocalName="Клиент" LocalListName="Клиенты" TitleName="Surname;Name;Patronymic" SqlModel="ISClientsSqlModel">
    <Fields>
      <Field UID="{45F40C47-C104-4FDB-9831-620A9F61E844}" Name="Surname" Type="String" LabelName="Фамилия" LocalListName="Фамилия" NotNull="true"/>
      <Field UID="{CE3773A2-8652-41AD-933C-8C9DABE6A6E3}" Name="Name" Type="String" LabelName="Имя" LocalListName="Имя" NotNull="true"/>
      <Field UID="{9F7ED2D9-D019-4F72-B20E-F446B1204BB9}" Name="Patronymic" Type="String" LabelName="Отчество" LocalListName="Отчество"/>
      <Field UID="{579A9B0A-0065-48E1-B39D-F45E6675AF1E}" Name="PhoneMobile" Type="String" LabelName="Телефон (мобильный)" LocalListName="Телефон (мобильный)" Hint="Номер телефона должен быть введен в следующем формате: +7-000-000-00-00"/>
      <Field UID="{072E6519-FFAC-4DAC-81E8-DFF4CFFABD85}" Name="PhoneAdding" Type="String" LabelName="Телефон (дополнительный)" LocalListName="Телефон (дополнительный)"/>
      <Field UID="{5D05BCB2-1538-4A96-BFD7-7E9FAE7C81E9}" Name="Address" Type="String" LabelName="Адрес" LocalListName="Адрес"/>
      <Field UID="{E8F2366C-DC36-42D3-8797-B5D60B8D6127}" Name="Responsible" Type="Int" LabelName="Ответственный" LocalListName="Ответственный"/>
      <Field UID="{FEB660FB-A69F-4CA5-8C07-3A7F6D1FF55E}" Name="CountInWork" Type="Int" LocalListName="Заказы в работе" QueryText="SELECT COUNT(*) FROM device WHERE NOT dvce_isdeleted AND dvce_client = clts_id AND dvce_dateissue IS NULL"/>
    </Fields>
    <Indexes>
      <Index Field="Surname"/>
      <Index Field="Name"/>
      <Index Field="Patronymic"/>
      <Index Field="PhoneMobile"/>
      <Index Field="PhoneAdding"/>
      <Index Field="Address"/>
      <Index Field="Responsible"/>
    </Indexes>
    <Foreigns>
      <Foreign Field="Responsible" ForeignClass="_Users" ForeignField="ID" ForeignViewNameField="Surname;Name;Patronymic"/>
    </Foreigns>
    <Escorts>
      <Escort LocalListName="Устройства" TableName="Device" ClassName="ISDeviceListForm"/>
    </Escorts>
  </Table>

  <Table Name="Device" UID="{3E565A60-0460-4AC0-8FF5-B35F5357F070}" Alias="dvce" LocalName="Устройство" LocalListName="Устройства" TitleName="" ObjectForm="ISDeviceObjectForm" ClassFilter="dvce_client = :ParentObjectID" ClassFilterField="Client">
    <Fields>
      <Field UID="{68703A53-E6A0-4256-B5EB-32C71CBC749D}" Name="Client" Type="Int" LabelName="Клиент" LocalListName="Клиент" NotNull="true" NotSearch="true" HideFromObject="true" HideFromList="true"/>
      <Field UID="{0BF24976-D7AA-4738-9158-82F1BF667111}" Name="DateIssue" Type="Date" LabelName="Дата выдачи" LocalListName="Дата выдачи" HideFromObject="true"/>
      <Field UID="{E77B5134-9281-48CC-B47E-DDC98363E232}" Name="GuaranteeRemont" Type="Bool" DefaultValue="false" LabelName="Гарантийный ремонт" LocalListName="Гарантийный ремонт"/>
      <Field UID="{0B7B691C-17CE-4E05-B5DF-E7E42FE1F0D8}" Name="Type" Type="Int" LabelName="Тип устройства" LocalListName="Тип устройства"/>
      <Field UID="{10FDEB51-6D88-49EF-8D23-024D3F3528F6}" Name="Brand" Type="Int" LabelName="Бренд" LocalListName="Бренд"/>
      <Field UID="{4335873C-AA5B-495A-B008-93051122C12D}" Name="Model" Type="Int" LabelName="Модель" LocalListName="Модель"/>
      <Field UID="{58D742B4-FEF0-4907-8CD9-9A2415BC86DD}" Name="SerialNumber" Type="String" LabelName="Серийный номер" LocalListName="Серийный номер"/>
      <Field UID="{07F16151-0C49-4D3D-A9F8-BDB6B5BA8A16}" Name="Color" Type="Int" LabelName="Цвет" LocalListName="Цвет"/>
      <Field UID="{38D6FDC7-1A7E-4F40-9D9F-6EFFDB685CFF}" Name="StageRepair" Type="Int" LabelName="Этап ремонта" LocalListName="Этап ремонта" NotNull="true"/>
      <Field UID="{4520446A-8FF3-4DDE-AF8E-05BB4A4692C4}" Name="ReasonPetition" Type="Text" LabelName="Причина обращения" LocalListName="Причина обращения"/>
      <Field UID="{E565D55E-8F2E-4888-8FE7-5078366D7FE0}" Name="Set" Type="Text" LabelName="Комплектность" LocalListName="Комплектность"/>
      <Field UID="{B6D14AEC-7EE7-479D-B16E-EFDF177565CE}" Name="ExternalView" Type="String" LabelName="Внешний вид" LocalListName="Внешний вид"/>
      <Field UID="{2E54ECA5-7EBE-4AE2-ADB7-65B01058E597}" Name="Exit" Type="Bool" DefaultValue="false" LabelName="Выезд" LocalListName="Выезд"/>
      <Field UID="{DF0033EE-7525-4328-A453-AF9BB05D2FB8}" Name="Guarantee" Type="String" LabelName="Гарантия" LocalListName="Гарантия"/>
      <Field UID="{736332AD-790D-42D4-A910-DA4C395FB860}" Name="Responsible" Type="Int" LabelName="Ответственный" LocalListName="Ответственный"/>
      <Field UID="{F625FE91-A756-4951-84DB-B9E92DDAB3C9}" Name="PriceDiagnostics" Type="Int" DefaultValue="400" DefaultValueWidget="400" LabelName="Цена диагностики" LocalListName="Цена диагностики"/>
      <Field UID="{001DD446-2731-4694-93A6-1F07DDA5CFC6}" Name="DiscoveredDefect" Type="String" LabelName="Выявленный дефект" LocalListName="Выявленный дефект" HideFromObject="true"/>
    </Fields>
    <Indexes>
      <Index Field="Client"/>
      <Index Field="DateIssue"/>
      <Index Field="GuaranteeRemont"/>
      <Index Field="Type"/>
      <Index Field="Brand"/>
      <Index Field="Model"/>
      <Index Field="SerialNumber"/>
      <Index Field="StageRepair"/>
      <Index Field="ReasonPetition"/>
      <Index Field="Set"/>
      <Index Field="ExternalView"/>
      <Index Field="Exit"/>
      <Index Field="Guarantee"/>
      <Index Field="Responsible"/>
      <Index Field="PriceDiagnostics"/>
      <Index Field="DiscoveredDefect"/>
    </Indexes>
    <Foreigns>
      <Foreign Field="Client" ForeignClass="Clients" ForeignField="ID" ForeignViewNameField="Surname;Name;Patronymic"/>
      <Foreign Field="Type" ForeignClass="DeviceType" ForeignField="ID" ForeignViewNameField="Name"/>
      <Foreign Field="Brand" ForeignClass="Brands" ForeignField="ID" ForeignViewNameField="Name"/>
      <Foreign Field="Model" ForeignClass="Models" ForeignField="ID" ForeignViewNameField="Name"/>
      <Foreign Field="Color" ForeignClass="Colors" ForeignField="ID" ForeignViewNameField="Name"/>
      <Foreign Field="StageRepair" ForeignClass="StageRepairs" ForeignField="ID" ForeignViewNameField="Name"/>
      <Foreign Field="Responsible" ForeignClass="_Users" ForeignField="ID" ForeignViewNameField="Surname;Name;Patronymic"/>
    </Foreigns>
    <Escorts>
      <Escort LocalName="Услуги" TableName="Services"/>
      <Escort LocalName="Детали" TableName="UsedParts"/>
    </Escorts>
  </Table>

  <Table Name="Services" UID="{C15E66F7-AD0D-4C9A-9EF0-784470939BF2}" Alias="srcs" LocalName="Услуга" LocalListName="Услуги" TitleName="Name" ClassFilter="srcs_device = :ParentObjectID" ClassFilterField="Device">
    <Fields>
      <Field UID="{2113FF97-DAF5-41F9-84D7-C99F32719252}" Name="Device" Type="Int" LabelName="Устройство" LocalListName="Устройство" NotNull="true" NotSearch="true" HideFromList="true" HideFromObject="true"/>
      <Field UID="{9585B4F5-5DC4-4F15-A362-1EF630EC281E}" Name="Type" Type="Int" LabelName="Тип услуги" LocalListName="Тип услуги"/>
      <Field UID="{C75215F6-9E3E-41A9-AC81-99D9D9665881}" Name="Name" Type="String" LabelName="Наименование" LocalListName="Наименование" NotNull="true"/>
      <Field UID="{F6128151-E44D-42A4-B710-44104DDBE002}" Name="Cost" Type="Double" LabelName="Стоимость" LocalListName="Стоимость"/>
      <Field UID="{ECDD8B8E-FD0D-446E-AA0C-9D83B9986772}" Name="Count" Type="Int" LabelName="Количество" LocalListName="Количество"/>
      <Field UID="{530C4048-AE45-4550-8AB8-04C0A4E06C64}" Name="Guarantee" Type="String" LabelName="Гарантия" LocalListName="Гарантия"/>
    </Fields>
    <Indexes>
      <Index Field="Device"/>
      <Index Field="Type"/>
      <Index Field="Name"/>
      <Index Field="Cost"/>
      <Index Field="Count"/>
      <Index Field="Guarantee"/>
    </Indexes>
    <Foreigns>
      <Foreign Field="Device" ForeignClass="Device" ForeignField="ID" ForeignViewNameField="ID"/>
      <Foreign Field="Type" ForeignClass="ServiceType" ForeignField="ID" ForeignViewNameField="Name"/>
    </Foreigns>
  </Table>

  <Table Name="UsedParts" UID="{C214B109-30C5-4E9E-B2DC-ECEF85288054}" Alias="uacs" LocalName="Деталь" LocalListName="Детали" TitleName="Name" ClassFilter="uacs_device = :ParentObjectID" ClassFilterField="Device">
    <Fields>
      <Field UID="{CDFFAA34-44F8-4279-BC11-DDC2216AD10F}" Name="Device" Type="Int" LabelName="Устройство" LocalListName="Устройство" NotNull="true" NotSearch="true" HideFromList="true" HideFromObject="true"/>
      <Field UID="{D9633262-E7B7-4A29-AB63-EE2F85323B15}" Name="Name" Type="String" LabelName="Наименование" LocalListName="Наименование" NotNull="true"/>
      <Field UID="{A49E8021-7DC5-48CA-B07B-0606771D7F3D}" Name="Cost" Type="Double" LabelName="Стоимость" LocalListName="Стоимость"/>
      <Field UID="{D774CFF2-B205-4A71-A17F-CA705CDE33A9}" Name="Count" Type="Int" LabelName="Количество" LocalListName="Количество"/>
      <Field UID="{53A50C6F-92C1-46E9-A80C-16436177A364}" Name="Guarantee" Type="String" LabelName="Гарантия" LocalListName="Гарантия"/>
    </Fields>
    <Indexes>
      <Index Field="Device"/>
      <Index Field="Name"/>
      <Index Field="Cost"/>
      <Index Field="Count"/>
      <Index Field="Guarantee"/>
    </Indexes>
    <Foreigns>
      <Foreign Field="Device" ForeignClass="Device" ForeignField="ID" ForeignViewNameField="ID"/>
    </Foreigns>
  </Table>

  <Query Name="ServicesDevice" UID="{90D85B73-CC03-4FDE-9F7C-49B6E12B97CA}" From="Services" Where="srcs_device = :DeviceID AND NOT srcs_isdeleted" Order="1">
    <Fields>
      <Field UID="{BB3C77DA-199B-4DD7-922A-D8CB8521F7FA}" Name="row_number() OVER (ORDER BY 1)" LocalName="п/п"/>
      <Field UID="{DF5244EE-1404-4A05-9B9F-84714DEFA4A3}" Name="srcs_name" LocalName="Наименование"/>
      <Field UID="{E972DED9-9256-492B-8AC2-CEE22672F572}" Name="srcs_count" LocalName="Количество"/>
      <Field UID="{7B21126E-2522-4899-9A5C-BB56429743FC}" Name="srcs_cost" LocalName="Стоимость"/>
      <Field UID="{7741A20B-5481-4437-94BE-5FC099F9702E}" Name="(srcs_count * srcs_cost)" LocalName="Сумма"/>
      <Field UID="{94736FFC-E8D6-4039-BC6F-B0050366367F}" Name="srcs_guarantee" LocalName="Гарантия"/>
    </Fields>
  </Query>

  <Query Name="UsedPartsDevice" UID="{95F37943-FB36-4A72-8634-8A3031D76740}" From="UsedParts" Where="uacs_device = :DeviceID AND NOT uacs_isdeleted" Order="1">
    <Fields>
      <Field UID="{F5D046CF-DBE2-497D-8FF0-67A66E172EE1}" Name="row_number() OVER (ORDER BY 1)" LocalName="п/п"/>
      <Field UID="{F5943505-1DB6-4D84-92C7-102E09E4AC95}" Name="uacs_name" LocalName="Наименование"/>
      <Field UID="{51D497AC-DD54-4F74-AA2A-6074A74368FF}" Name="uacs_count" LocalName="Количество"/>
      <Field UID="{6403DD51-3CE5-40DA-B875-9756A73E77E4}" Name="uacs_cost" LocalName="Стоимость"/>
      <Field UID="{4921E072-77B2-493D-86A0-0598C38D0A04}" Name="(uacs_count * uacs_cost)" LocalName="Сумма"/>
      <Field UID="{C062BC48-1E83-44A7-A5AB-2C8D4BDCC3A2}" Name="uacs_guarantee" LocalName="Гарантия"/>
    </Fields>
  </Query>
</XSN>